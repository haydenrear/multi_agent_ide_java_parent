databaseChangeLog:
  - changeSet:
      id: 001-create-artifact-table
      author: hayden
      changes:
        - createTable:
            tableName: artifact
            columns:
              - column:
                  name: created_time
                  type: TIMESTAMP

              - column:
                  name: referenced_artifact_key
                  type: VARCHAR(30000)

              - column:
                  name: updated_time
                  type: TIMESTAMP

              - column:
                  name: created_by
                  type: VARCHAR(255)

              - column:
                  name: modified_by
                  type: VARCHAR(255)

              - column:
                  name: uuid
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: artifact_key
                  type: VARCHAR(30000)
                  constraints:
                    nullable: false
                    unique: true

              - column:
                  name: parent_key
                  type: VARCHAR(30000)

              - column:
                  name: execution_key
                  type: VARCHAR(30000)
                  constraints:
                    nullable: false

              - column:
                  name: artifact_type
                  type: VARCHAR(30000)
                  constraints:
                    nullable: false

              - column:
                  name: content_hash
                  type: VARCHAR(30000)
                  constraints:
                    unique: true

              - column:
                  name: content_json
                  type: TEXT

              - column:
                  name: depth
                  type: INTEGER
                  constraints:
                    nullable: false

              - column:
                  name: template_static_id
                  type: VARCHAR(30000)

              - column:
                  name: shared
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

              - column:
                  name: schema_version
                  type: VARCHAR(32)
                  defaultValue: "0.0.1"
                  constraints:
                    nullable: false

        - createIndex:
            tableName: artifact
            indexName: idx_artifact_key
            columns:
              - column:
                  name: artifact_key

        - createIndex:
            tableName: artifact
            indexName: idx_parent_key
            columns:
              - column:
                  name: parent_key

        - createIndex:
            tableName: artifact
            indexName: idx_execution_key
            columns:
              - column:
                  name: execution_key

        - createIndex:
            tableName: artifact
            indexName: idx_artifact_type
            columns:
              - column:
                  name: artifact_type

        - createIndex:
            tableName: artifact
            indexName: idx_content_hash
            columns:
              - column:
                  name: content_hash

        - createIndex:
            tableName: artifact
            indexName: idx_created_time
            columns:
              - column:
                  name: created_time

  - changeSet:
      id: 002-create-artifact-child-ids-table
      author: hayden
      changes:
        - createTable:
            tableName: artifact_child_ids
            columns:
              - column:
                  name: artifact_id
                  type: BIGINT
                  constraints:
                    nullable: false

              - column:
                  name: child_id
                  type: VARCHAR(30000)
                  constraints:
                    nullable: false

              - column:
                  name: child_order
                  type: INTEGER
                  constraints:
                    nullable: false

        - addPrimaryKey:
            tableName: artifact_child_ids
            columnNames: artifact_id, child_order
            constraintName: pk_artifact_child_ids

        - createIndex:
            tableName: artifact_child_ids
            indexName: idx_artifact_child_ids_artifact_id
            columns:
              - column:
                  name: artifact_id

        - createIndex:
            tableName: artifact_child_ids
            indexName: idx_artifact_child_ids_child_id
            columns:
              - column:
                  name: child_id

        - addUniqueConstraint:
            tableName: artifact_child_ids
            columnNames: artifact_id, child_id
            constraintName: uq_artifact_child_ids_parent_child

#        - addForeignKeyConstraint:
#            baseTableName: artifact_child_ids
#            baseColumnNames: artifact_id
#            referencedTableName: artifact
#            referencedColumnNames: uuid
#            constraintName: fk_child_ids_parent_artifact
#            onDelete: CASCADE

#        - addForeignKeyConstraint:
#            baseTableName: artifact_child_ids
#            baseColumnNames: child_id
#            referencedTableName: artifact
#            referencedColumnNames: artifact_key
#            constraintName: fk_child_ids_child_artifact_key
#            onDelete: RESTRICT
#            onUpdate: CASCADE

  - changeSet:
      id: 003-create-artifact-refs-table
      author: hayden
      changes:
        - createTable:
            tableName: artifact_refs
            columns:
              - column:
                  name: artifact_id
                  type: BIGINT
                  constraints:
                    nullable: false

              - column:
                  name: ref
                  type: VARCHAR(512)
                  constraints:
                    nullable: false

              - column:
                  name: ref_order
                  type: INTEGER
                  constraints:
                    nullable: false

        - addPrimaryKey:
            tableName: artifact_refs
            columnNames: artifact_id, ref_order
            constraintName: pk_artifact_refs

        - createIndex:
            tableName: artifact_refs
            indexName: idx_artifact_refs_artifact_id
            columns:
              - column:
                  name: artifact_id

        - createIndex:
            tableName: artifact_refs
            indexName: idx_artifact_refs_ref
            columns:
              - column:
                  name: ref

        - addUniqueConstraint:
            tableName: artifact_refs
            columnNames: artifact_id, ref
            constraintName: uq_artifact_refs_parent_ref

        - addForeignKeyConstraint:
            baseTableName: artifact_refs
            baseColumnNames: artifact_id
            referencedTableName: artifact
            referencedColumnNames: uuid
            constraintName: fk_refs_parent_artifact
            onDelete: CASCADE

        - addForeignKeyConstraint:
            baseTableName: artifact_refs
            baseColumnNames: ref
            referencedTableName: artifact
            referencedColumnNames: artifact_key
            constraintName: fk_refs_ref_artifact_key
            onDelete: RESTRICT
            onUpdate: CASCADE

  - changeSet:
      id: 004-create-semantic-representations-table
      author: hayden
      changes:
        - createTable:
            tableName: semantic_representations
            columns:
              # PK as per your entity field "uuid"
              - column:
                  name: uuid
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: semantic_key
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
                    unique: true

              - column:
                  name: target_artifact_key
                  type: VARCHAR(30000)
                  constraints:
                    nullable: false

              - column:
                  name: derivation_recipe_id
                  type: VARCHAR(128)
                  constraints:
                    nullable: false

              - column:
                  name: derivation_recipe_version
                  type: VARCHAR(64)

              - column:
                  name: model_ref
                  type: VARCHAR(256)

              - column:
                  name: quality_metadata
                  type: TEXT

              - column:
                  name: payload_type
                  type: VARCHAR(64)
                  constraints:
                    nullable: false

              - column:
                  name: payload
                  type: TEXT

              # Postgres: BYTEA. For MySQL, use LONGBLOB.
              - column:
                  name: payload_binary
                  type: BYTEA

              # --- auditing columns (same pattern as artifact) ---
              - column:
                  name: created_time
                  type: TIMESTAMP

              - column:
                  name: updated_time
                  type: TIMESTAMP

              - column:
                  name: created_by
                  type: VARCHAR(255)

              - column:
                  name: modified_by
                  type: VARCHAR(255)

        # indexes per your @Table annotation
        - createIndex:
            tableName: semantic_representations
            indexName: idx_semantic_target
            columns:
              - column: { name: target_artifact_key }

        - createIndex:
            tableName: semantic_representations
            indexName: idx_semantic_recipe
            columns:
              - column: { name: derivation_recipe_id }

        - createIndex:
            tableName: semantic_representations
            indexName: idx_semantic_type
            columns:
              - column: { name: payload_type }

        - createIndex:
            tableName: semantic_representations
            indexName: idx_semantic_created
            columns:
              - column: { name: created_time }

        # FK to artifact via artifact_key (optional but usually what you want)
        - addForeignKeyConstraint:
            baseTableName: semantic_representations
            baseColumnNames: target_artifact_key
            referencedTableName: artifact
            referencedColumnNames: artifact_key
            constraintName: fk_semantic_target_artifact_key
            onDelete: RESTRICT
            onUpdate: CASCADE

