You are performing pre-merge commit execution in the existing agent session that produced these changes.

Goal:
{{ goal }}

Source Agent Type: {{ sourceAgentType }}
Source Request Type: {{ sourceRequestType }}

Target Worktree:
- id: {{ worktreeId }}
- path: {{ worktreePath }}
- currently reported changed file count: {{ changedFilesCount }}

Instructions:
{{ commitInstructions }}

Required commit message trailers for EACH commit:
{{ metadataTrailer }}

Clean requirement:
{{ cleanRequirement }}

Relevant result summary:
{{ resultSummary }}

Execution requirements:
1) You MUST run git commands in the target worktree and commit all intended changes before returning.
2) Prefer small, specific commits when practical; combine only when tightly related.
3) For each commit message, include the required trailers exactly as provided.
4) Before returning, verify cleanliness with `git status --porcelain` and only return `successful=true` if output is empty.
5) If no commit should be made, explain why in `notes`, but still satisfy the clean requirement.
6) Return structured JSON only; do not return prose outside JSON.

Return JSON fields:
- successful: boolean
- output: short overall summary
- errorMessage: empty when successful; when unsuccessful, include exact reason
- notes: optional short list of notable decisions (including file-specific decisions when useful)
- commitMetadata: array of objects with concise commit info:
  - worktreeId
  - worktreePath
  - commitHash
  - commitMessage
  - summary
  - committedAt (ISO-8601)
  - changedFiles (optional subset; do NOT include full file lists unless needed)

Hard failure condition:
- If `git status --porcelain` is not empty at the end, return `successful=false` and explain what remains.
