{
  "$schema" : "https://json-schema.org/draft/2020-12/schema",
  "$defs" : {
    "ArtifactKey" : {
      "type" : "object",
      "additionalProperties" : false
    },
    "ConsolidationSummary" : {
      "type" : "object",
      "properties" : {
        "consolidatedOutput" : {
          "type" : "string"
        },
        "metadata" : {
          "$ref" : "#/$defs/Map(String,String)"
        }
      },
      "additionalProperties" : false
    },
    "DiagramRepresentation" : {
      "type" : "object",
      "properties" : {
        "diagramId" : {
          "type" : "string"
        },
        "diagramType" : {
          "type" : "string",
          "enum" : [ "CLASS", "SEQUENCE", "COMPONENT", "DATA_FLOW", "DEPENDENCY" ]
        },
        "edges" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/$defs/Map(String,Object)"
          }
        },
        "mermaidSource" : {
          "type" : "string"
        },
        "nodes" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/$defs/Map(String,Object)"
          }
        },
        "title" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "DiscoveryCollectorContext" : {
      "type" : "object",
      "properties" : {
        "contextId" : {
          "$ref" : "#/$defs/ArtifactKey"
        },
        "curation" : {
          "type" : "object",
          "properties" : {
            "consolidationSummary" : {
              "$ref" : "#/$defs/ConsolidationSummary"
            },
            "contextId" : {
              "$ref" : "#/$defs/ArtifactKey"
            },
            "discoveryReports" : {
              "type" : "array",
              "items" : {
                "type" : "object",
                "properties" : {
                  "architectureOverview" : {
                    "type" : "string"
                  },
                  "contextId" : {
                    "$ref" : "#/$defs/ArtifactKey"
                  },
                  "crossLinks" : {
                    "type" : "array",
                    "items" : {
                      "type" : "object",
                      "properties" : {
                        "description" : {
                          "type" : "string"
                        },
                        "linkId" : {
                          "type" : "string"
                        },
                        "linkType" : {
                          "type" : "string",
                          "enum" : [ "CALLS", "DEPENDS_ON", "IMPLEMENTS", "EXTENDS", "RELATED_TO", "DATA_FLOW" ]
                        },
                        "sourceReferenceId" : {
                          "type" : "string"
                        },
                        "targetReferenceId" : {
                          "type" : "string"
                        }
                      },
                      "additionalProperties" : false
                    }
                  },
                  "diagrams" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/DiagramRepresentation"
                    }
                  },
                  "fileReferences" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/FileReference"
                    }
                  },
                  "generatedQueries" : {
                    "type" : "array",
                    "items" : {
                      "type" : "object",
                      "properties" : {
                        "expectedResultPaths" : {
                          "type" : "array",
                          "items" : {
                            "type" : "string"
                          }
                        },
                        "groundTruthRelevance" : {
                          "$ref" : "#/$defs/Map(String,Double)"
                        },
                        "queryId" : {
                          "type" : "string"
                        },
                        "queryText" : {
                          "type" : "string"
                        },
                        "queryType" : {
                          "type" : "string",
                          "enum" : [ "CODE_SEARCH", "PATTERN_FIND", "DEPENDENCY_TRACE", "API_LOOKUP", "TEST_FIND" ]
                        }
                      },
                      "additionalProperties" : false
                    }
                  },
                  "integrationPoints" : {
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "keyPatterns" : {
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "memoryReferences" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/MemoryReference"
                    }
                  },
                  "relevanceScores" : {
                    "$ref" : "#/$defs/Map(String,Double)"
                  },
                  "resultId" : {
                    "$ref" : "#/$defs/ArtifactKey"
                  },
                  "schemaVersion" : {
                    "type" : "string"
                  },
                  "semanticTags" : {
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/SemanticTag"
                    }
                  },
                  "upstreamContextId" : {
                    "$ref" : "#/$defs/ArtifactKey"
                  }
                },
                "additionalProperties" : false
              }
            },
            "memoryReferences" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/$defs/MemoryReference"
              }
            },
            "querySpecificFindings" : {
              "type" : "object",
              "additionalProperties" : false
            },
            "recommendations" : {
              "type" : "array",
              "items" : {
                "type" : "object",
                "properties" : {
                  "description" : {
                    "type" : "string"
                  },
                  "estimatedImpact" : {
                    "type" : "string"
                  },
                  "priority" : {
                    "type" : "string",
                    "enum" : [ "CRITICAL", "HIGH", "MEDIUM", "LOW" ]
                  },
                  "recommendationId" : {
                    "type" : "string"
                  },
                  "relatedFilePaths" : {
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "title" : {
                    "type" : "string"
                  }
                },
                "additionalProperties" : false
              }
            },
            "unifiedCodeMap" : {
              "type" : "object",
              "properties" : {
                "deduplicatedReferences" : {
                  "type" : "array",
                  "items" : {
                    "$ref" : "#/$defs/FileReference"
                  }
                },
                "mergedTags" : {
                  "type" : "array",
                  "items" : {
                    "$ref" : "#/$defs/SemanticTag"
                  }
                },
                "modules" : {
                  "type" : "array",
                  "items" : {
                    "type" : "object",
                    "properties" : {
                      "dependencies" : {
                        "type" : "array",
                        "items" : {
                          "type" : "string"
                        }
                      },
                      "moduleName" : {
                        "type" : "string"
                      },
                      "relatedFiles" : {
                        "type" : "array",
                        "items" : {
                          "type" : "string"
                        }
                      },
                      "summary" : {
                        "type" : "string"
                      }
                    },
                    "additionalProperties" : false
                  }
                },
                "unifiedDiagram" : {
                  "$ref" : "#/$defs/DiagramRepresentation"
                }
              },
              "additionalProperties" : false
            }
          },
          "additionalProperties" : false
        },
        "selectionRationale" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "FileReference" : {
      "type" : "object",
      "properties" : {
        "endLine" : {
          "type" : "integer"
        },
        "filePath" : {
          "type" : "string"
        },
        "relevanceScore" : {
          "type" : "number"
        },
        "snippet" : {
          "type" : "string"
        },
        "startLine" : {
          "type" : "integer"
        },
        "tags" : {
          "type" : "array",
          "items" : {
            "type" : "string"
          }
        }
      },
      "additionalProperties" : false
    },
    "Map(String,Double)" : {
      "type" : "object",
      "additionalProperties" : false
    },
    "Map(String,Object)" : {
      "type" : "object",
      "additionalProperties" : false
    },
    "Map(String,String)" : {
      "type" : "object",
      "additionalProperties" : false
    },
    "MemoryReference" : {
      "type" : "object",
      "properties" : {
        "memoryType" : {
          "type" : "string"
        },
        "metadata" : {
          "$ref" : "#/$defs/Map(String,String)"
        },
        "referenceId" : {
          "type" : "string"
        },
        "summary" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "MergeDescriptor" : {
      "type" : "object",
      "properties" : {
        "conflictFiles" : {
          "type" : "array",
          "items" : {
            "type" : "string"
          }
        },
        "errorMessage" : {
          "type" : "string"
        },
        "mainWorktreeMergeResult" : {
          "$ref" : "#/$defs/MergeResult"
        },
        "mergeDirection" : {
          "type" : "string",
          "enum" : [ "TRUNK_TO_CHILD", "CHILD_TO_TRUNK", "WORKTREE_TO_SOURCE" ]
        },
        "submoduleMergeResults" : {
          "type" : "array",
          "items" : {
            "type" : "object",
            "properties" : {
              "childWorktreePath" : {
                "type" : "string"
              },
              "mergeResult" : {
                "$ref" : "#/$defs/MergeResult"
              },
              "parentWorktreePath" : {
                "type" : "string"
              },
              "pointerUpdated" : {
                "type" : "boolean"
              },
              "submoduleName" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false
          }
        },
        "successful" : {
          "type" : "boolean"
        }
      },
      "additionalProperties" : false
    },
    "MergeResult" : {
      "type" : "object",
      "properties" : {
        "childWorktreeId" : {
          "type" : "string"
        },
        "childWorktreePath" : {
          "type" : "string"
        },
        "conflicts" : {
          "type" : "array",
          "items" : {
            "type" : "object",
            "properties" : {
              "baseContent" : {
                "type" : "string"
              },
              "conflictType" : {
                "type" : "string"
              },
              "filePath" : {
                "type" : "string"
              },
              "oursContent" : {
                "type" : "string"
              },
              "submodulePath" : {
                "type" : "string"
              },
              "theirsContent" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false
          }
        },
        "mergeCommitHash" : {
          "type" : "string"
        },
        "mergeId" : {
          "type" : "string"
        },
        "mergeMessage" : {
          "type" : "string"
        },
        "mergedAt" : {
          "type" : "string",
          "format" : "date-time"
        },
        "parentWorktreeId" : {
          "type" : "string"
        },
        "parentWorktreePath" : {
          "type" : "string"
        },
        "submoduleUpdates" : {
          "type" : "array",
          "items" : {
            "type" : "object",
            "properties" : {
              "newCommitHash" : {
                "type" : "string"
              },
              "oldCommitHash" : {
                "type" : "string"
              },
              "requiresResolution" : {
                "type" : "boolean"
              },
              "submoduleName" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false
          }
        },
        "successful" : {
          "type" : "boolean"
        }
      },
      "additionalProperties" : false
    },
    "Path" : {
      "type" : "object",
      "additionalProperties" : false
    },
    "PlanningCollectorContext" : {
      "type" : "object",
      "properties" : {
        "contextId" : {
          "$ref" : "#/$defs/ArtifactKey"
        },
        "curation" : {
          "type" : "object",
          "properties" : {
            "consolidationSummary" : {
              "$ref" : "#/$defs/ConsolidationSummary"
            },
            "contextId" : {
              "$ref" : "#/$defs/ArtifactKey"
            },
            "dependencyGraph" : {
              "type" : "array",
              "items" : {
                "type" : "object",
                "properties" : {
                  "dependencyType" : {
                    "type" : "string"
                  },
                  "fromTicketId" : {
                    "type" : "string"
                  },
                  "toTicketId" : {
                    "type" : "string"
                  }
                },
                "additionalProperties" : false
              }
            },
            "finalizedTickets" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/$defs/PlanningTicket"
              }
            },
            "memoryReferences" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/$defs/MemoryReference"
              }
            },
            "planningAgentResults" : {
              "type" : "array",
              "items" : {
                "type" : "object",
                "properties" : {
                  "contextId" : {
                    "$ref" : "#/$defs/ArtifactKey",
                    "description" : "Unique context id for this result."
                  },
                  "mergeDescriptor" : {
                    "$ref" : "#/$defs/MergeDescriptor",
                    "description" : "Merge descriptor from trunk→child merge."
                  },
                  "output" : {
                    "type" : "string",
                    "description" : "Human-readable summary output."
                  },
                  "tickets" : {
                    "description" : "Proposed planning tickets.",
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/PlanningTicket"
                    }
                  }
                },
                "description" : "Result payload from a planning agent.",
                "additionalProperties" : false
              }
            }
          },
          "additionalProperties" : false
        },
        "selectionRationale" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "PlanningTicket" : {
      "type" : "object",
      "properties" : {
        "acceptanceCriteria" : {
          "type" : "array",
          "items" : {
            "type" : "string"
          }
        },
        "contextId" : {
          "$ref" : "#/$defs/ArtifactKey"
        },
        "dependencies" : {
          "type" : "array",
          "items" : {
            "type" : "string"
          }
        },
        "description" : {
          "type" : "string"
        },
        "discoveryLinks" : {
          "type" : "array",
          "items" : {
            "type" : "object",
            "properties" : {
              "discoveryResultId" : {
                "$ref" : "#/$defs/ArtifactKey"
              },
              "linkRationale" : {
                "type" : "string"
              },
              "referenceId" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false
          }
        },
        "effortEstimate" : {
          "type" : "string"
        },
        "memoryReferences" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/$defs/MemoryReference"
          }
        },
        "priority" : {
          "type" : "integer"
        },
        "resultId" : {
          "$ref" : "#/$defs/ArtifactKey"
        },
        "schemaVersion" : {
          "type" : "string"
        },
        "tasks" : {
          "type" : "array",
          "items" : {
            "type" : "object",
            "properties" : {
              "description" : {
                "type" : "string"
              },
              "estimatedHours" : {
                "type" : "number"
              },
              "relatedFiles" : {
                "type" : "array",
                "items" : {
                  "type" : "string"
                }
              },
              "taskId" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false
          }
        },
        "ticketId" : {
          "type" : "string"
        },
        "title" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "SemanticTag" : {
      "type" : "object",
      "properties" : {
        "appliedTo" : {
          "type" : "array",
          "items" : {
            "type" : "string"
          }
        },
        "confidence" : {
          "type" : "number"
        },
        "tagCategory" : {
          "type" : "string",
          "enum" : [ "ARCHITECTURE", "PATTERN", "DATA_FLOW", "ENTRY_POINT", "TEST", "INTEGRATION", "SECURITY", "PERFORMANCE" ]
        },
        "tagId" : {
          "type" : "string"
        },
        "tagName" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "SubmoduleWorktreeContext" : {
      "type" : "object",
      "properties" : {
        "associatedNodeId" : {
          "type" : "string"
        },
        "baseBranch" : {
          "type" : "string"
        },
        "createdAt" : {
          "type" : "string",
          "format" : "date-time"
        },
        "lastCommitHash" : {
          "type" : "string"
        },
        "mainWorktreeId" : {
          "type" : "string"
        },
        "metadata" : {
          "$ref" : "#/$defs/Map(String,String)"
        },
        "parentWorktreeId" : {
          "type" : "string"
        },
        "status" : {
          "$ref" : "#/$defs/WorktreeStatus"
        },
        "submoduleName" : {
          "type" : "string"
        },
        "worktreeId" : {
          "type" : "string"
        },
        "worktreePath" : {
          "$ref" : "#/$defs/Path"
        }
      },
      "additionalProperties" : false
    },
    "TicketCollectorContext" : {
      "type" : "object",
      "properties" : {
        "contextId" : {
          "$ref" : "#/$defs/ArtifactKey"
        },
        "curation" : {
          "type" : "object",
          "properties" : {
            "completionStatus" : {
              "type" : "string"
            },
            "consolidationSummary" : {
              "$ref" : "#/$defs/ConsolidationSummary"
            },
            "contextId" : {
              "$ref" : "#/$defs/ArtifactKey"
            },
            "followUps" : {
              "type" : "array",
              "items" : {
                "type" : "string"
              }
            },
            "memoryReferences" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/$defs/MemoryReference"
              }
            },
            "ticketAgentResults" : {
              "type" : "array",
              "items" : {
                "type" : "object",
                "properties" : {
                  "commits" : {
                    "description" : "Commit references or hashes.",
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "contextId" : {
                    "$ref" : "#/$defs/ArtifactKey",
                    "description" : "Unique context id for this result."
                  },
                  "filesModified" : {
                    "description" : "Files modified during execution.",
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "implementationSummary" : {
                    "type" : "string",
                    "description" : "Summary of implementation completed."
                  },
                  "memoryReferences" : {
                    "description" : "Memory references used during execution.",
                    "type" : "array",
                    "items" : {
                      "$ref" : "#/$defs/MemoryReference"
                    }
                  },
                  "mergeDescriptor" : {
                    "$ref" : "#/$defs/MergeDescriptor",
                    "description" : "Merge descriptor from trunk→child merge."
                  },
                  "output" : {
                    "type" : "string",
                    "description" : "Human-readable summary output."
                  },
                  "testResults" : {
                    "description" : "Test results or verification output.",
                    "type" : "array",
                    "items" : {
                      "type" : "string"
                    }
                  },
                  "ticketId" : {
                    "type" : "string",
                    "description" : "Ticket identifier being implemented."
                  },
                  "verificationStatus" : {
                    "type" : "string",
                    "description" : "Verification status summary."
                  }
                },
                "description" : "Result payload from a ticket execution agent.",
                "additionalProperties" : false
              }
            }
          },
          "additionalProperties" : false
        },
        "selectionRationale" : {
          "type" : "string"
        }
      },
      "additionalProperties" : false
    },
    "WorktreeSandboxContext" : {
      "type" : "object",
      "properties" : {
        "mainWorktree" : {
          "type" : "object",
          "properties" : {
            "associatedNodeId" : {
              "type" : "string"
            },
            "baseBranch" : {
              "type" : "string"
            },
            "createdAt" : {
              "type" : "string",
              "format" : "date-time"
            },
            "derivedBranch" : {
              "type" : "string"
            },
            "hasSubmodules" : {
              "type" : "boolean"
            },
            "lastCommitHash" : {
              "type" : "string"
            },
            "metadata" : {
              "$ref" : "#/$defs/Map(String,String)"
            },
            "parentWorktreeId" : {
              "type" : "string"
            },
            "status" : {
              "$ref" : "#/$defs/WorktreeStatus"
            },
            "submoduleWorktrees" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/$defs/SubmoduleWorktreeContext"
              }
            },
            "worktreeId" : {
              "type" : "string"
            },
            "worktreePath" : {
              "$ref" : "#/$defs/Path"
            }
          },
          "additionalProperties" : false
        },
        "submoduleWorktrees" : {
          "type" : "array",
          "items" : {
            "$ref" : "#/$defs/SubmoduleWorktreeContext"
          }
        }
      },
      "additionalProperties" : false
    },
    "WorktreeStatus" : {
      "type" : "string",
      "enum" : [ "ACTIVE", "MERGED", "DISCARDED" ]
    }
  },
  "type" : "object",
  "properties" : {
    "collectorRequest" : {
      "allOf" : [ {
        "type" : "object",
        "properties" : {
          "contextId" : {
            "$ref" : "#/$defs/ArtifactKey",
            "description" : "Unique context id for this request."
          },
          "discoveryCuration" : {
            "$ref" : "#/$defs/DiscoveryCollectorContext",
            "description" : "Curated discovery context from discovery collector."
          },
          "goal" : {
            "type" : "string",
            "description" : "Workflow goal statement."
          },
          "mergeDescriptor" : {
            "$ref" : "#/$defs/MergeDescriptor",
            "description" : "Merge descriptor from final merge to source repository."
          },
          "phase" : {
            "type" : "string",
            "description" : "Current workflow phase."
          },
          "planningCuration" : {
            "$ref" : "#/$defs/PlanningCollectorContext",
            "description" : "Curated planning context from planning collector."
          },
          "previousContext" : {
            "type" : "object",
            "properties" : {
              "attemptNumber" : {
                "type" : "integer"
              },
              "contextId" : {
                "$ref" : "#/$defs/ArtifactKey"
              },
              "errorMessage" : {
                "type" : "string"
              },
              "errorStackTrace" : {
                "type" : "string"
              },
              "previousAttemptAt" : {
                "type" : "string",
                "format" : "date-time"
              },
              "previousContextId" : {
                "$ref" : "#/$defs/ArtifactKey"
              },
              "previousDiscoveryCuration" : {
                "$ref" : "#/$defs/DiscoveryCollectorContext"
              },
              "previousPlanningCuration" : {
                "$ref" : "#/$defs/PlanningCollectorContext"
              },
              "previousTicketCuration" : {
                "$ref" : "#/$defs/TicketCollectorContext"
              },
              "serializedOutput" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false,
            "description" : "Previous orchestrator collector context for reruns."
          },
          "ticketCuration" : {
            "$ref" : "#/$defs/TicketCollectorContext",
            "description" : "Curated ticket context from ticket collector."
          },
          "worktreeContext" : {
            "$ref" : "#/$defs/WorktreeSandboxContext",
            "description" : "Worktree sandbox context for this request."
          }
        },
        "description" : "Orchestrator collector request to finalize workflow outputs.",
        "additionalProperties" : false
      }, {
        "description" : "Route to orchestrator collector for finalization."
      } ]
    },
    "contextManagerRequest" : {
      "allOf" : [ {
        "type" : "object",
        "properties" : {
          "contextId" : {
            "$ref" : "#/$defs/ArtifactKey",
            "description" : "Unique context id for this request."
          },
          "missingContextDescription" : {
            "type" : "string",
            "description" : "Specific description of what information is missing."
          },
          "reason" : {
            "type" : "string",
            "description" : "Clear explanation of what context you need blackboard intra-agent context."
          },
          "suggestedSources" : {
            "type" : "string",
            "description" : "Optional hints about which agent or phase might have the needed context."
          },
          "type" : {
            "type" : "string",
            "enum" : [ "INTROSPECT_AGENT_CONTEXT", "PROCEED" ],
            "description" : "Type of context reconstruction to request."
          },
          "worktreeContext" : {
            "$ref" : "#/$defs/WorktreeSandboxContext",
            "description" : "Worktree sandbox context for this request."
          }
        },
        "description" : "Lightweight request to route to the context manager.",
        "additionalProperties" : false
      }, {
        "description" : "Route to context manager for context reconstruction."
      } ]
    },
    "discoveryOrchestratorRequest" : {
      "allOf" : [ {
        "type" : "object",
        "properties" : {
          "contextId" : {
            "$ref" : "#/$defs/ArtifactKey",
            "description" : "Unique context id for this request."
          },
          "feedback" : {
            "type" : "string",
            "description" : "Provide any feedback from interrupt requests."
          },
          "goal" : {
            "type" : "string",
            "description" : "Workflow goal statement."
          },
          "previousContext" : {
            "type" : "object",
            "properties" : {
              "attemptNumber" : {
                "type" : "integer"
              },
              "contextId" : {
                "$ref" : "#/$defs/ArtifactKey"
              },
              "errorMessage" : {
                "type" : "string"
              },
              "errorStackTrace" : {
                "type" : "string"
              },
              "previousAttemptAt" : {
                "type" : "string",
                "format" : "date-time"
              },
              "previousContextId" : {
                "$ref" : "#/$defs/ArtifactKey"
              },
              "previousDiscoveryCuration" : {
                "$ref" : "#/$defs/DiscoveryCollectorContext"
              },
              "previousPlanningCuration" : {
                "$ref" : "#/$defs/PlanningCollectorContext"
              },
              "previousTicketCuration" : {
                "$ref" : "#/$defs/TicketCollectorContext"
              },
              "serializedOutput" : {
                "type" : "string"
              }
            },
            "additionalProperties" : false,
            "description" : "Previous discovery orchestrator context for reruns."
          },
          "worktreeContext" : {
            "$ref" : "#/$defs/WorktreeSandboxContext",
            "description" : "Worktree sandbox context for this request."
          }
        },
        "description" : "Request for the discovery orchestrator to partition and dispatch discovery work.",
        "additionalProperties" : false
      }, {
        "description" : "Route to discovery orchestrator."
      } ]
    },
    "interruptRequest" : {
      "allOf" : [ {
        "type" : "object",
        "properties" : {
          "choices" : {
            "description" : "Structured decision choices for the controller.",
            "type" : "array",
            "items" : {
              "type" : "object",
              "properties" : {
                "choiceId" : {
                  "type" : "string",
                  "description" : "Stable identifier for this choice."
                },
                "context" : {
                  "type" : "string",
                  "description" : "Additional context for the decision."
                },
                "options" : {
                  "$ref" : "#/$defs/Map(String,String)",
                  "description" : "Options map with keys A/B/C/CUSTOM."
                },
                "question" : {
                  "type" : "string",
                  "description" : "Decision question posed to the controller."
                },
                "recommended" : {
                  "type" : "string",
                  "description" : "Recommended option key if applicable."
                }
              },
              "description" : "Multiple-choice decision with optional write-in.",
              "additionalProperties" : false
            }
          },
          "confirmationItems" : {
            "description" : "Yes/no confirmations required for continuation.",
            "type" : "array",
            "items" : {
              "type" : "object",
              "properties" : {
                "confirmationId" : {
                  "type" : "string",
                  "description" : "Stable identifier for this confirmation."
                },
                "context" : {
                  "type" : "string",
                  "description" : "Additional context for the confirmation."
                },
                "defaultValue" : {
                  "type" : "boolean",
                  "description" : "Default value when unspecified."
                },
                "impactIfNo" : {
                  "type" : "string",
                  "description" : "Impact if the confirmation is denied."
                },
                "statement" : {
                  "type" : "string",
                  "description" : "Confirmation statement to approve or deny."
                }
              },
              "description" : "Yes/no confirmation item for interrupt decisions.",
              "additionalProperties" : false
            }
          },
          "contextForDecision" : {
            "type" : "string",
            "description" : "Concise context needed to make the decision."
          },
          "contextId" : {
            "$ref" : "#/$defs/ArtifactKey"
          },
          "goal" : {
            "type" : "string",
            "description" : "Workflow goal statement."
          },
          "phase" : {
            "type" : "string",
            "description" : "Current workflow phase (DISCOVERY, PLANNING, TICKETS, COMPLETE)."
          },
          "reason" : {
            "type" : "string",
            "description" : "Natural language explanation of the uncertainty."
          },
          "type" : {
            "type" : "string",
            "enum" : [ "HUMAN_REVIEW", "AGENT_REVIEW", "PAUSE", "STOP", "BRANCH", "PRUNE" ],
            "description" : "Interrupt type (HUMAN_REVIEW, AGENT_REVIEW, PAUSE, STOP)."
          },
          "workflowContext" : {
            "type" : "string",
            "description" : "High-level workflow context or state summary."
          },
          "worktreeContext" : {
            "$ref" : "#/$defs/WorktreeSandboxContext",
            "description" : "Worktree sandbox context for this request."
          }
        },
        "description" : "Interrupt request for orchestrator-level workflow steering.",
        "additionalProperties" : false
      }, {
        "description" : "Interrupt request for orchestration decisions."
      } ]
    }
  },
  "description" : "Routing result for the orchestrator.",
  "additionalProperties" : false
}